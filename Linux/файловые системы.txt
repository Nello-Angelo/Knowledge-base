-----------------------------------------------------------------------------------------------------------NFS on CentOS7-----------------------------------------------------------------------------------------------------------------
nfs-utils - пакет nfs-utils предоставляет демон для сервера NFS ядра и связанных инструментов
который обеспечивает гораздо более высокий уровень производительности
чем традиционный сервер NFS Linux, используемый большинством пользователей.
nfs4-acl-tools - этот пакет содержит утилиты командной строки и графического интерфейса пользователя ACL для клиента Linux NFSv4
/etc/nfs.conf — основной файл конфигурации для демонов и инструментов NFS (здесь можно отключать/включать параметры/версии NFS)
/etc/nfsmount.conf — файл конфигурации монтирования NFS (здесь управляем параметрами монтирования)
/etc/exports (файл для описания путей для экспорта)
rw – права на запись в каталоге, ro – доступ только на чтение, wdelay - отложенная запись
sync – синхронный режим доступа. async – подразумевает, что не нужно ожидать подтверждения записи на диск (повышает производительность NFS, но уменьшает надежность);
no_root_squash – разрешает root пользователю с клиента получать доступ к NFS каталогу, отключить вытеснение привелегий root (обычно не рекомендуется);
no_all_squash — включение авторизации пользователя. all_squash – вытеснение привелегий для всех (работа от пользователя nfsnobody)
no_subtree_check – отключить проверку, что пользователь обращается к файлу в определенном каталоге (subtree_check – используется по умолчанию);
root_squash - вытеснение привелегий root для одного пользователя, no_acl - отключение опции контроля доступом
anonuid, anongid – сопоставить NFS пользователю/группу указанному локальному пользователю/группе(UID и GID), подменяем на нужные нам


yum install nfs-utils nfs4-acl-tools iptables-services (на сервере и клиенте)
systemctl start/enable nfs-server iptables (на сервере и клиенте)
cat /proc/fs/nfsd/versions (активные версии)
nano /etc/sysconfig/iptables (открываем порты на сервере)
-A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT (порт для 4 версии)
mkdir -p /filesys/nfs/ && touch /filesys/nfs/test.txt && chmod -R 777 /filesys/nfs/ && chown -R nfsnobody:nfsnobody /filesys/nfs/ (создаем папку в которой будем хранить файлы и меняем владельца с правами)
/filesys/nfs 192.168.80.137/24(rw,sync) (в файл /etc/exports добавляем запись о сервере на который делаем экспорт) (в скобках указываем типы прав rw,sync...)
/filesys/nfs 192.168.80.137/24(rw,sync) 192.168.80.136/24(rw,sync,ro)... (пример экспорта для нескольких хостов)  /filesys/nfs 192.168.80.0/24(rw,sync) (экспорт для всей подсети)
exportfs -a (команда для экспорта указанного) exportfs (покажет настройки монтирования)
systemctl restart nfs-server 
mkdir /nfs (создайте на клиенте) 
mount -t nfs -o vers=4 192.168.80.138:/filesys/nfs/ /nfs (тип файловой системы, версия, адрес NFS, путь с файла exports и папка в которую монтируем на клиенте, выполнить на клиенте)
exportfs -u 192.168.80.137/24:/filesys/nfs (отмонтируем имеющийся экспорт у клиента с указанием полного пути на сервере) umount /path/to/mount (отмонтировать на клиенте)
/etc/fstab (чтобы монтировать определенный том при загрузке системы нужно добавить отдельную запись в этот файл на клиенте, пример: домен или ip-адрес nfs-server:/path/from/export     /path/to/mount     nfs    opts-of-mount 0 0)  

